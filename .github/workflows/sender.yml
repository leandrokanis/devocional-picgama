name: Trigger Daily Devotional

on:
  schedule:
    - cron: '0 9 * * *'  # Executa diariamente às 06:00 (UTC-3)
  workflow_dispatch:      # Permite execução manual

jobs:
  trigger:
    runs-on: ubuntu-latest
    
    steps:
    - name: Send devotional request
      env:
        SERVER_URL: ${{ secrets.SERVER_URL }}
        AUTH_TOKEN: ${{ secrets.AUTH_TOKEN }}
      run: |
        echo "Triggering devotional at $SERVER_URL"
        response=$(curl -s -w "\n%{http_code}" -X POST "${SERVER_URL}/send" \
          -H "Authorization: Bearer ${AUTH_TOKEN}" \
          -H "Content-Type: application/json")
        
        http_code=$(echo "$response" | tail -n1)
        body=$(echo "$response" | sed '$d')
        
        echo "Response Code: $http_code"
        echo "Response Body: $body"
        
        if [ "$http_code" -ne 200 ]; then
          echo "Failed to trigger devotional"
          exit 1
        fi
